{% extends "AssoMakerBaseBundle::layout.html.twig"  %}
{% set pageTitle = 'Accueil' %}

{% block pageHeader %}
{% endblock %}

{% block content %}

{% if is_granted('ROLE_VISITOR') %}
	<div class="row-fluid">
		<h1>Bonsoir {{ app.user.prenom }} !</h1>
		<hr>
	</div>
	<div class="row-fluid">
		<div class="span4">
          <h2>Mes Informations</h2>
	       		       {% if not app.user.anneeEtudes or not app.user.departement or (not app.user.groupePC and (app.user.anneeEtudes == 1 or app.user.anneeEtudes == 2))%}
		       	<div class="alert alert-block alert-error fade in">
		            <h4 class="alert-heading">Tu n'a pas renseigné les informations suivantes :</h4>
		            <ul>
		            {% if not app.user.anneeEtudes%}<li>Année d'études</li>{% endif %}
		            {% if not app.user.departement%}<li>Département INSA</li>{% endif %}
		            {% if not app.user.groupePC and (app.user.anneeEtudes == 1 or app.user.anneeEtudes == 2)  %}<li>Numéro de groupe Premier Cycle</li>{% endif %}
		            {% if not app.user.ProfilePictureSet%}<li>Photo de Trombinoscope</li>{% endif %}
		            </ul>
		        </div>
	          {% endif %}
		          <div class="well">
		          	<div class="row-fluid">
		          	<h3>{{ entitiesMacro.orga(app.user) }}</h3>
		          	</div>
			          <div class="row-fluid">
				          <div class="span3">
                            {% if app.user.profilePictureSet == 1 %}
                        	    <img src="{{ entitiesMacro.orgaProfilePictureLink(app.user.id) }}" class="img-polaroid" style="width:90%"/>
                            {% endif %}
				          </div>
				          <div class="span9">
					          <p>{{ app.user.email }} - {{ app.user.telephone |telephone}}</p>
					          <dl class="dl-horizontal">
						        
						        <b>Date de Naissance : </b>
						        {{ app.user.dateDeNaissance|format_date('dd MMM Y') }}<br>
						        <b>Équipe : </b>
						        {{ entitiesMacro.equipe(app.user.equipe) }}<br>
						        <b>Permis de conduire : </b>
						        {% if app.user.datePermis %}
						        obtenu le {{ app.user.datePermis|format_date('dd MMM Y') }}.
						        {% else %}
						        non titulaire
						        {% endif%}<br>
						        <b>Département : </b>
								{{ app.user.anneeEtudes }}{{ app.user.departement }}
								{% if app.user.groupePC %}
								(groupe {{ app.user.groupePC }})
						        {% endif %}<br>		        
						      </dl>
					    	</div>
					    </div>
					    	<div class="row-fluid">
						    	<p>
						    		<a class="btn" href="{{ path('orga_edit',{'id':app.user.id }) }}"><i class="icon-pencil"></i> Modifier mes informations »</a>
						    		{% if base_signature_actif ==1 %}
						    		    <a class="btn" href="{{ path('orga_signature') }}"><i class="icon-envelope"></i> Générer ma signature email »</a>
						    	    {% endif %}
						    	</p>
					    	</div>
				    </div>
    		</div>
	   {% if comptes_perso_actif and (app.user.equipe.comptesPersoEnabled or is_granted('ROLE_HUMAIN') ) %}
	   <div class="span4">
          <h2>Mon compte perso</h2>
          {% if soldeCP < 0 %}
			<div class="alert alert-block alert-error">
		            <h4 class="alert-heading">Attention : ton compte perso est déficitaire !</h4>
		            <p>
		            Tu dois actuellement <em>{{ soldeCP|number_format(2) }}€</em>  à l'association !
		            </p>
		    
		  {% else %}
		  	<div class="well">
		            <p>Il te reste actuellement <em>{{ soldeCP|number_format(2) }}€</em> sur ton compte.</p>
		    
		  {% endif %}
		  	<h4>Détail des transactions</h4>
            		  	<table class="table">
                <thead>
                    <tr>
                        <th>Montant</th>
                        <th>Date</th>
                        <th>Détail</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in transactionsCP %}
                    {% if loop.index == '6' %}
                    
                        </tbody>
                    </table>
                    <div id="demo" class="collapse">
                    <table class="table">
                    <tbody>
                    {% endif %}
                    <tr>
                        <td>{{ transaction.amount |number_format(2) }}€</td>
                        <td>{{ transaction.commitDate |format_date('dd MMM Y HH:mm')}}</td>
                        <td>{{ transaction.comment }}</td>
                    </tr>
            
                    {% endfor %}
                        </tbody>
            </table>
            {% if transactionsCP|length > 5 %}
                </div>
            {% endif %}
			<button type="button" class="btn" data-toggle="collapse" data-target="#demo">  Afficher toutes les transactions </button>
			<a class="btn" href="{{ url('comptesPerso_virement') }}"><i class="icon-credit-card"></i> Effectuer un virement »</a>
			</div>

	    </div>
	    {% endif %}
	    
	    {% if is_granted('ROLE_HUMAIN') %}	
			<div class="span4">
	        	<h2>Gestion des Inscriptions</h2>
	        	{% if statsOrga.nonValidated > 0%}
		       	<div class="alert alert-block alert-info fade in">
		            <h4 class="alert-heading">Il reste {{ statsOrga.nonValidated }} orgas non validés.</h4>
		            <a class="btn" href="{{ path('orga', {'statut':0}) }}"><i class="icon-list"></i> Afficher la liste »</a>
		        </div>
		        {% endif %}
	       </div>
	    	{% endif %}
	    	
	    {% if not is_granted('ROLE_USER') %}
	    	<div class="span4">
    	    	<h2>Actions</h2>
        	    	<div class="well">
            	    	<a class="btn {% if phpm_planning_visiteurs == 0 %}btn-primary {% endif %}btn-large" href="{{ path('orga_inputdispos',{'id':app.user.id }) }}"><i class="icon-calendar"></i> Renseigner mes disponibilités »</a></p>
            			{% if (planning[0] is defined) and  (phpm_planning_visiteurs ==1) %}
            	        <a class="btn btn-primary btn-large" href="{{ path('orga_print', {'orgaid':app.user.id }) }}"><i class="icon-print"></i> Imprimer mon planning »</a>
            	        {% endif %}
        	    	</div>
	    	</div>
	    {% endif %}
	    </div>
	    <div class="row-fluid">
	    {% if is_granted('ROLE_HUMAIN') %}	
	    	<div class="span4">
		        <h2>Impression des Plannings</h2>
		       	<div class="alert alert-block alert-info fade in">
					<form name="input" action="{{ path('orga_plannings') }}" method="post">
						<fieldset>
							Début : {{ form_widget(printPlanningForm.debut,  { 'attr': {'class': 'datep'} }) }}
							Fin : {{ form_widget(printPlanningForm.fin,  { 'attr': {'class': ' datep'} }) }}
							<br>
							Orga : {{ form_widget(printPlanningForm.orga)}} <b>OU</b>
							Équipe : {{ form_widget(printPlanningForm.equipe) }}
							<br>
							<button class="btn btn-primary" type="submit" name="action" value="print" >Imprimer</button>
							<button class="btn" type="submit" name="action" value="show" >Afficher</button>
						</fieldset>
					</form>
		        </div>
	       </div>
	    {% endif %}
{#    	{% if (planning[0] is defined) and (is_granted('ROLE_USER')) %}	
		<div class="span{% if is_granted('ROLE_HUMAIN') %}8{% else %}12{% endif %}">
        	<h2>Planning prévisionnel</h2>
        		Planning valable du {{ debutPlanning | format_datetime('EEEE dd MMM Y HH:mm') }} au  {{ finPlanning | format_datetime('EEEE dd MMM Y HH:mm') }}.
				{% include 'AssoMakerBaseBundle:Orga:planningTable.html.twig' with {'disponibilites': planning[0].disponibilites}%}
				<a class="btn btn-primary" href="{{ path('orga_print', {'orgaid':app.user.id }) }}"><i class="icon-print"></i> Imprimer mon planning »</a>
				<a class="btn" href="https://www.google.com/calendar/render?cid={{ url('orga_ical', {'orgaid':app.user.id }) }}"><i class="icon-calendar"></i> Importer dans Google Agenda »</a>
       </div>
    	{% endif %} #}

	    </div>		
	    
{% else %}
	<div class="hero-unit">
	{{ phpm_contenu_page_principale |raw}}
    {% if app.session.hasFlash('notice') %}
        <div class="alert alert-error">
            {{ app.session.flash('notice') }}
        </div>
    {% endif %}
			<p>
				<a class="btn btn-primary btn-large" href="{{ url('login') }}">Se connecter</a>
			</p>
	</div>

{% endif %}

{% endblock %}

