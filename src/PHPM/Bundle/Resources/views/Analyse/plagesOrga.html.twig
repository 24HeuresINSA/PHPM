{% extends "PHPMBundle::layout.html.twig"  %}
{% set pageTitle = 'Utilisation du Matériel' %}
{% use "PHPMBundle::index.html.twig" %}

{% block pageHeader %}
{% endblock %}

{% block content %}

<div class="row-fluid">       
        	<div class="page-header">
	        	<h1>Rapport d'occupation des Orgas</h1>
	            <p>Données générées à partir des fiches tâches.</p>
	        </div>
</div>
<div class="row-fluid"> 

{% for o in respResult %}
 <h2>{{ entitiesMacro.orga(o) }}</h2>
 {% if is_granted('ROLE_ADMIN') %}
 <div class="btn-toolbar">
<a class="btn btn-primary" href="{{ path('orga_affectHint', { 'id': o.id })  }}"><i class="icon-print"></i> Auto affecter les créneaux de l'orga</a>
<a class="btn dropdown-toggle" data-toggle="dropdown" href="#">Actions <span class="caret"></span></a>
<ul class="dropdown-menu">
            <li><a href="{{ path('orga_edit', { 'id': o.id })  }}"><i class="icon-pencil"></i> Éditer</a></li>
            <li><a href="{{ path('orga_inputdispos', { 'id': o.id }) }}"><i class="icon-calendar"></i>Dispos</a></li>
            <li><a href="{{ path('orga_affectation', { 'orga_id': o.id }) }}"><i class="icon-book"></i>Affecter</a></li>
            <li><a href="{{ path('orga_print', { 'id': o.id })  }}"><i class="icon-print"></i> Imprimer le planning</a></li>
			          	
 </ul>

</div>
{% endif %}
 <hr>

	<table class="table table-condensed">
        <thead>
        	<tr>
	        	<th>Tâche</th>
	            <th>Horaires</th>
            </tr>
        </thead>
        <tbody>
        {% set prev=0 %}
        {% for b in o.besoinsOrgaHint %}
			

            <tr>
            	<td>{{ b.plageHoraire.tache.groupeTache.nom }} / {{ entitiesMacro.tache(b.plageHoraire.tache) }}</td>
            	<td>
                	{% if b.plageHoraire.debut.timestamp < prev %}
                <b style="color: red;font-size: medium;">{% endif %}
        		{{ b.plageHoraire.debut | format_datetime('EEEE dd MMM Y HH:mm') }} <i class="icon-arrow-right"></i> {{ b.plageHoraire.fin | format_datetime('EEEE dd MMM Y HH:mm') }}
                {% if b.plageHoraire.debut.timestamp < prev %}
                CONFLIT</b>{% endif %}
                
                </td>
                
               
            </tr>
		{% set prev=b.plageHoraire.fin.timestamp %}	
		{% endfor %}
		
        </tbody>
    </table>
{% endfor %}


</div>
   

{% endblock %}
