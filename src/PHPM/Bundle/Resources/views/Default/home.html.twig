{% extends "PHPMBundle::layout.html.twig"  %}
{% set pageTitle = 'Accueil' %}

{% block pageHeader %}
{% endblock %}

{% block content %}

{% if is_granted('ROLE_VISITOR') %}
	<div class="row-fluid">
		<h1>Bonsoir {{ app.user.prenom }} !</h1>
		<hr>
	</div>
	<div class="row-fluid">
	
		
			<div class="span4">
	          <h2>Mes Informations</h2>
		       {% if not app.user.anneeEtudes or not app.user.departement or (not app.user.groupePC and (app.user.anneeEtudes == 1 or app.user.anneeEtudes == 2))%}
		       	<div class="alert alert-block alert-error fade in">
		            <h4 class="alert-heading">Tu n'a pas renseigné les informations suivantes :</h4>
		            <ul>
		            {% if not app.user.anneeEtudes%}<li>Année d'études</li>{% endif %}
		            {% if not app.user.departement%}<li>Département INSA</li>{% endif %}
		            {% if not app.user.groupePC and (app.user.anneeEtudes == 1 or app.user.anneeEtudes == 2)  %}<li>Numéro de groupe Premier Cycle</li>{% endif %}
		            </ul>
		        </div>
		       {% else %}
	          <p><em>Assure-toi que ces informations sont toujours à jour.</em></p>
	          {% endif %}
		          <div class="well">
		          <h3>{{ entitiesMacro.orga(app.user) }}</h3>
		          <p>{{ app.user.email }} - {{ app.user.telephone }}</p>
		          <dl class="dl-horizontal">
			        
			        <b>Date de Naissance : </b>
			        {{ app.user.dateDeNaissance|format_date('dd MMM Y') }}<br>
			        <b>Équipe : </b>
			        {{ entitiesMacro.equipe(app.user.equipe) }}<br>
			        <b>Permis de conduire : </b>
			        {% if app.user.datePermis %}
			        obtenu le {{ app.user.datePermis|format_date('dd MMM Y') }}.
			        {% else %}
			        non titulaire
			        {% endif%}<br>
			        <b>Département : </b>
					{{ app.user.anneeEtudes }}{{ app.user.departement }}
					{% if app.user.groupePC %}
					(groupe {{ app.user.groupePC }})
			        {% endif %}<br>		        
			      </dl>
		          <p><a class="btn" href="{{ path('orga_edit',{'id':app.user.id }) }}"><i class="icon-pencil"></i> Modifier mes informations »</a></p>
		    	</div>
	    	</div>
	    
	    {% if is_granted('ROLE_USER') %}	
			<div class="span4">
	          <h2>Fiches Tâches</h2>
		          {% if (statsOrga.taches.orga[0] + statsOrga.taches.equipe[0]) > 0 %}
						<div class="alert alert-block alert-error fade in">
		            		<h4 class="alert-heading">Il te reste des fiches tâches à rédiger.</h4>
		        		</div>
			  	  {% endif %}
			  	  {% if deadlineFT %}
						<div class="alert alert-block alert-warning fade in">
		            		<h4 class="alert-heading"> La limite d'envoi en validation des fiches tâches est <em>{{ deadlineFT | format_datetime('EEEE dd MMM \à HH:mm') }}</em></h4>
		        		</div>
			  	  {% endif %}
		          <h3>Statistiques</h3>
			          <table class="table table-condensed">
					    <thead>
					        <tr> 
					        	<td></td>
					            <th>Toi</th>
					            <th>Ton équipe</th>
					        </tr>
					    </thead>
					    <tbody>
					        <tr class="statut0">
						        <td>En rédaction</td>
						        <td>{{ statsOrga.taches.orga[0]}}</td>
							    <td>{{ statsOrga.taches.equipe[0]}}</td>
					        </tr>
					        <tr class="statut1">
						        <td>En validation</td>
						        <td>{{ statsOrga.taches.orga[1]}}</td>
							    <td>{{ statsOrga.taches.equipe[1]}}</td>
					        </tr>  
					        <tr class="statut2">
						        <td>Validées</td>
						        <td>{{ statsOrga.taches.orga[2]}}</td>
							    <td>{{ statsOrga.taches.equipe[2]}}</td>
					        </tr>  
					    </tbody>
					</table>
					
	          <p><a class="btn" href="{{ path('tache',{'orgaid': app.user.id}) }}"><i class="icon-file"></i> Accéder aux fiches tâches »</a></p>
	    	</div>
	    	
	    	
			<div class="span4">
	          <h2>Disponibilités</h2>
	       {% if statsOrga.PCMax ==0 %}
	       	<div class="alert alert-block alert-info fade in">
	            <h4 class="alert-heading">Il n'est pas encore possible de renseigner de disponibilités.</h4>
	        </div>
	       {% else %}
	    	{% if statsOrga.PCOrga==0 and statsOrga.PCMax>0%}
			<div class="alert alert-block alert-error fade in">
	            <h4 class="alert-heading">Aucun charisme !</h4>
	            <p>Tu n'as pas encore renseigné tes disponibilités.</p>
				<p><a class="btn" href="{{ path('orga_inputdispos',{'id':app.user.id }) }}"><i class="icon-calendar"></i> Renseigner mes disponibilités »</a></p>
	        </div>
			{% else %}
				{% if statsOrga.nbOrgas != 0 and statsOrga.PCOrga<(statsOrga.PCTotal/statsOrga.nbOrgas) %}
						<div class="alert alert-block  fade in">
				            <a class="close" data-dismiss="alert" href="#">×</a>
				            <h4 class="alert-heading">Faible charisme !</h4>
				            <p>Tu as renseigné peu de disponibilités.</p>
				            <p><a class="btn" href="{{ path('orga_inputdispos',{'id':app.user.id }) }}"><i class="icon-calendar"></i> Ajouter des disponibilités</a></p>
				        </div>
				{% endif %}
				<div class="well">
					<h2>Ton charisme :</h2>
					<div class="progress progress-success progress-striped">
				        <div id="barreCharisme" class="bar"></div>
				        <script type="text/javascript">
						$('#barreCharisme').attr('style',"width: {{ statsOrga.PCOrga/statsOrga.PCMax*100 }}%");
				        </script>
				    </div>
				    <div style="text-align: center;">
				    	<p>Points de charisme : {{ statsOrga.PCOrga}}/{{statsOrga.PCMax }}<br>
				    	Classement : {{ statsOrga.rangCharisme}}/{{statsOrga.nbOrgas }}
				    	</p>
				    </div>			
				</div>
				<div class="btn-toolbar"><a class="btn btn-primary" href="{{ path('orga_inputdispos',{'id':app.user.id }) }}"><i class="icon-calendar"></i> Modifier mes disponibilités »</a>
				<a class="btn" href="{{ path('orga_charisme') }}">Statistiques Charisme »</a></div>
			{% endif %}
			{% endif %}
	    	</div>
			
	{% endif %}
	</div>	
	<div class="row-fluid">

	    {% if is_granted('ROLE_ADMIN') %}	
			<div class="span4">
	        	<h2>Gestion des Inscriptions</h2>
	        	{% if statsOrga.nonValidated > 0%}
		       	<div class="alert alert-block alert-info fade in">
		            <h4 class="alert-heading">Il reste {{ statsOrga.nonValidated }} orgas non validés.</h4>
		            <a class="btn" href="{{ path('orga', {'statut':0}) }}"><i class="icon-list"></i> Afficher la liste »</a>
		        </div>
		        {% endif %}
		        <h2>Impression des Plannings</h2>
		       	<div class="alert alert-block alert-info fade in">
					<form name="input" action="{{ path('orga_plannings') }}" method="post">
					<label for="debut">Date de début</label>
					<input type="text" name="debut" value="{{ 'now' | format_datetime('Y-MM-dd') }}" />
					<label for="fin">Date de fin</label>
					<input type="text" name="fin" placeholder="Date de fin"/>
					<input class="btn btn-primary" type="submit" value="Imprimer" />
					</form>
		        </div>
	       </div>
	    	{% endif %}
	    	{% if is_granted('ROLE_VISITOR') and planning[0] is defined %}	
			<div class="span{% if is_granted('ROLE_ADMIN') %}8{% else %}12{% endif %}">
	        	<h2>Planning prévisionnel</h2>
	        		Planning valable du {{ debutPlanning | format_datetime('EEEE dd MMM Y HH:mm') }} au  {{ finPlanning | format_datetime('EEEE dd MMM Y HH:mm') }}.
					<table class="table well">
						<thead>
						<tr>
							<th>Horaires</th><th>Tâche</th><th>Avec</th><th>Lieu</th>
						</tr>
						<tbody>
							{% for d in planning[0].disponibilites %}
								{% for creneau in d.creneaux %}
									<tr>
									<td>{{ creneau.debut | format_datetime('EEEE dd MMM Y HH:mm') }}
	  									-> {{ creneau.fin | format_datetime('EEEE dd MMM HH:mm') }}</td>
	  								<td>{{ creneau.plageHoraire.tache.groupeTache.nom }} / {{ creneau.plageHoraire.tache.nom }}</td>
	  								<td>
									{% for c2 in creneau.plageHoraire.creneaux if  c2.id != creneau.id %}
							 			{{ entitiesMacro.orga(c2.disponibilite.orga) }}, 
							 		{% endfor %}
							 		</td>
	  								<td>{{ creneau.plageHoraire.tache.lieu }}</td>
									</tr>
								{% endfor %}
							{% endfor %}
						</tbody>
					
					</table>
					<a class="btn" href="{{ path('orga_print', {'orgaid':app.user.id }) }}"><i class="icon-print"></i> Imprimer mon planning »</a>


	  
{# 	  <h4></h4>#}
{# 	  	</div>#}
	  	
{# 	  <div class="lieu"><h4>{{ creneau.plageHoraire.tache.lieu }}</h4></div>#}
{# 	 </div>#}
{# 	 	<div class="infos">#}
{# 	 		<div class="titre"><h3>{{ creneau.plageHoraire.tache.groupeTache.nom }} / {{ creneau.plageHoraire.tache.nom }}</h3></div>#}
{# 	 		<b>Responsable : </b>{{ entitiesMacro.orga(creneau.plageHoraire.tache.responsable) }} #}
{# 	 									{{ creneau.plageHoraire.tache.responsable.telephone }}#}
{# 	 	</div>#}
{# 	  <div class="consignes">#}
{# 	    <h4>Consignes</h4>{{ creneau.plageHoraire.tache.consignes |raw}}#}
{# 	  </div>#}
{# 	  <div class="consignes">#}
{# 	    <h4>Matériel Nécessaire</h4>#}
{# 			{% for bm in creneau.plageHoraire.tache.besoinsMateriel %}#}
{# 	    		{% if bm.quantite > 0 %}#}
{# 			{{ bm.materiel.nom }},#}
{# 			{% endif %}#}
{# 	    	{% endfor %}#}


{#  	{% endfor %}#}
{# 	{% endfor %}#}
{# 		        {% endif %}#}

	  
	       </div>
	    	{% endif %}

	</div>		
	
{% else %}
	<div class="hero-unit">
	{{ phpm_contenu_page_principale |raw}}
			<p>
				<a class="btn btn-primary btn-large" href="{{ url('login') }}">Se connecter</a>
			</p>
	</div>

{% endif %}
{% endblock %}

