{% extends "PHPMBundle::layout.html.twig"  %}
{% set pageTitle = 'CreneauMaker' %}

{# {% form_theme form _self %}#}


{% block pageHeader %}
{% endblock %}

{% block content %}
   
    <div class="row-fluid">       
    	<div class="page-header">
         	<h1>Gestion des créneaux : {{ tache.nom }}</h1>
         	<br>
         	Gestion des créneaux
         	<br>
         	<a class="btn" href="{{ path('tache_edit', { 'id': tache.id }) }}" ><i class="icon-share-alt"></i> Retour à la fiche</a>
         </div>
    </div>
    
    <div class="row-fluid">   
	    {% for ph in tache.plagesHoraire %}
	    	<h3>Plage horaire : {{ ph.debut | format_datetime }} <i class="icon-arrow-right"></i> {{ ph.fin | format_datetime }}</h3>
	    	{% if ph.creneauUnique %}
	    	<b>Créneau Unique</b>
	    	{% else %}
	    	<b>Durée des créneaux :</b>
                {{ ph.dureeCreneau/3600}}h
                {% if ph.recoupementCreneau != 0 %} ({{ ph.recoupementCreneau/60 }}m){% endif %}
	    	{% endif %}
	    	<br>
	    	<b>Besoins : </b>
 			{% if ph.respNecessaire  %}<b>(RESP)</b> {% endif %}
		                
                {% for bo in ph.besoinsOrga %}
                	{% if bo.orgaHint is null %}
                	({{ bo.equipe }} : {{ bo.nbOrgasNecessaires }})
                	{% else %}
                	<b>({{ bo.orgaHint }})</b>
                	{% endif %}
                
                {% endfor %}
		    
		    
		    
	    	{% if ph.creneaux.count >0 %}
	    		{% if tache.statut ==2 %}
				    <br>
				    <a class="btn btn-danger" href="{{ path('creneaumaker_deleteallph', { 'id': ph.id }) }}"><i class="icon-remove"></i> Tout Supprimer</a>
				    <br>
			    {% endif %}
				    <table class="table table-condensed">
			        <thead>
			            <th>Créneau</th>
			            <th>Orga Nécessaire</th>
			            <th>Équipe nécessaire</th>
			            <th>Orga Affecté</th>
			            {% if tache.statut ==2 %}
			            <th>Actions</th>
			            {% endif %}
			        </thead>
			        <tbody>
					{% for c in ph.creneaux %}
			            <tr>
			            	<td>
			                	{{ c.debut | format_datetime }} <i class="icon-arrow-right"></i> {{ c.fin | format_datetime }}
			                </td>
			                <td>
				                {% if c.orgaHint is not null %}
									{{ entitiesMacro.orga(c.orgaHint) }}
				                {% else %}
				                	-
				                {% endif %}
			                </td>
			                <td>
				                {% if c.equipeHint is not null %}
									{{ c.equipeHint }}
				                {% else %}
				                	-
				                {% endif %}
			                </td>
			                <td>
				                {% if c.disponibilite is not null %}
									{{ entitiesMacro.orga(c.disponibilite.orga) }}
				                {% else %}
				                	-
				                {% endif %}
			                </td>
			                {% if tache.statut ==2 %}
				                <td>
					                <div class="btn-group">
					                <a class="btn " href="{{ path('creneau_edit', { 'id': c.id }) }}"><i class="icon-pencil"></i> Éditer</a>
					                <a class="btn  btn-danger" href="{{ path('creneau_delete', { 'id': c.id }) }}"><i class="icon-remove"></i> Supprimer</a>
					                </div>
				                </td>
			                {% endif %}
			            </tr>
			        {% endfor %}
			        </tbody>
			    </table>
		    {% else %}
			    <div class="alert alert-info">
			    Cette plage horaire ne comporte pas de créneaux.
				{% if tache.statut ==2 %}
				    <br>
				    <a class="btn btn-success" href="{{ path('creneaumaker_genererph', { 'id': ph.id }) }}"><i class="icon-plus"></i> Générer</a>
				{% endif %}
			    </div>
	    	{% endif %}	
	    {% endfor %}
    </div>
    <div class="row-fluid">
		<div class="form-actions">
		    <div class="btn-group">
		    	{% if tache.statut ==3  %}
        		<a class="btn  btn-danger" href="{{ path('creneaumaker_deoktache', { 'id': tache.id }) }}"></i> Modifier la tâche</a>
        		{% endif %}
		    	{% if tache.statut ==2  %}
        		<a class="btn btn-success" href="{{ path('tache_okaffectation', { 'id': tache.id }) }}"><i class="icon-arrow-right"></i> Tâche prête pour affectation</a>
        		{% endif %}
		</div>
	</div>
</div>

{% endblock %}
